<Window x:Class="WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Patient Visit Management"
        Height="700"
        Width="1100">

    <!-- ROOT CANVAS allows overlapping -->
    <Canvas>
        <!-- BACKGROUND GRID (central content) -->
        <Grid Canvas.ZIndex="0" Height="706" Canvas.Top="10" Width="1090">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- TOP TOOLBAR -->
            <DockPanel Grid.Row="0" Background="#f0f0f0" Height="40" LastChildFill="False">
                <Button x:Name="ToggleLeftPanelButton"
            Content="Register New Patient"
            Width="170" Height="32" Margin="5,4,0,4"
            Background="#0078D4" Foreground="White"
            Click="ToggleLeftPanelButton_Click"
            DockPanel.Dock="Left"/>

                <Button x:Name="ToggleRightPanelButton"
            Content="Previous Visits"
            Width="170" Height="32" Margin="0,4,5,4"
            Background="#0078D4" Foreground="White"
            Click="ToggleRightPanelButton_Click"
            DockPanel.Dock="Right"/>
            </DockPanel>

            <!-- CENTRAL CONTENT (fills remaining width) -->
            <ScrollViewer Grid.Row="1" x:Name="MainContentScrollViewer"
              VerticalScrollBarVisibility="Auto"
              PreviewMouseWheel="ScrollViewer_PreviewMouseWheel" Grid.ColumnSpan="2">
                <Grid Background="#f5f5f5" Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- LOGIN -->
                    <Expander Grid.Row="0" x:Name="LoginExpander" Header="Login to Medical Records System"
                  Background="#f0f0f0" Padding="5" Margin="0,0,0,10" IsExpanded="True">
                        <StackPanel Background="White" Margin="10">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                <Label Content="API URL:" Width="80"/>
                                <TextBox x:Name="TxtApiUrl" Width="250" Margin="5,0,10,0"/>
                                <Button Content="Test Connection" Click="TestConnectionButton_Click"/>
                            </StackPanel>
                            <Label Content="Username:"/>
                            <TextBox x:Name="TxtUsername"/>
                            <Label Content="Password:"/>
                            <PasswordBox x:Name="TxtPassword" Margin="0,0,0,15"/>
                            <Button x:Name="LoginButton" Content="Login" Width="100" Height="35"
                        Background="#0078D4" Foreground="White" Click="LoginButton_Click"/>
                            <TextBlock x:Name="StatusText" Margin="0,15,0,0" Foreground="Gray" FontStyle="Italic"/>
                        </StackPanel>
                    </Expander>

                    <!-- PATIENT MANAGEMENT -->
                    <Expander Grid.Row="1" x:Name="PatientManagementExpander" Header="Patient Management"
                  Padding="15" Margin="0,0,0,10">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <TextBox x:Name="TxtPatientSearch" Width="200" Margin="0,0,10,0"
                             TextChanged="TxtPatientSearch_TextChanged"/>
                                <Button Content="Search"/>
                            </StackPanel>
                            <Label Content="Select Patient:"/>
                            <ListBox x:Name="PatientListBox" Height="200"
                         SelectionChanged="PatientListBox_SelectionChanged">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding DisplayName}" Padding="5"/>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                            <StackPanel Orientation="Horizontal" Margin="0,10,0,10">
                                <Button Content="Refresh" Margin="0,0,10,0" Click="RefreshPatientsButton_Click"/>
                                <Button Content="+ Add New Patient" Background="#28a745" Foreground="White"
                            Click="AddNewPatientButton_Click"/>
                            </StackPanel>
                            <Border x:Name="SelectedPatientBorder" Visibility="Collapsed" Padding="10">
                                <StackPanel>
                                    <TextBlock Text="Selected Patient" FontWeight="Bold"/>
                                    <TextBlock x:Name="SelectedPatientInfo"/>
                                    <TextBlock x:Name="SelectedPatientDetails" Foreground="Gray"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Expander>

                    <!-- VISIT MANAGEMENT (fills remaining space) -->
                    <Expander Grid.Row="2" x:Name="VisitManagementExpander" Header="Visit Management"
                  Padding="15" IsExpanded="True">
                        <StackPanel>
                            <Label Content="Diagnosis:"/>
                            <TextBox x:Name="TxtDiagnosis" Height="60"/>
                            <Label Content="Notes:"/>
                            <TextBox x:Name="TxtNotes" Height="80"/>
                            <Button x:Name="SaveVisitButton" Content="Save Visit" Width="120" Height="35"
                        Background="#0078D4" Foreground="White" Click="SaveVisitButton_Click"/>
                        </StackPanel>
                    </Expander>
                </Grid>
            </ScrollViewer>
        </Grid>

        <!-- OVERLAY LEFT PANEL -->
        <Border x:Name="LeftPanelBorder"
                Canvas.ZIndex="100"
                Width="400"
                Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Window}}"
                Canvas.Left="0"
                Canvas.Top="40"
                Background="White"
                BorderBrush="#e0e0e0"
                BorderThickness="0,0,1,0"
                Visibility="Collapsed">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0" Background="#f0f0f0" Padding="10" BorderBrush="#e0e0e0" BorderThickness="0,0,0,1">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch">
                        <TextBlock Text="Register New Patient" FontWeight="Bold" VerticalAlignment="Center"/>
                        <Button x:Name="CloseLeftPanelButton"
                                Content="×" FontSize="16" FontWeight="Bold"
                                Width="30" Height="30" HorizontalAlignment="Right"
                                Click="CloseLeftPanelButton_Click"
                                Background="Transparent" BorderThickness="0"/>
                    </StackPanel>
                </Border>

                <!-- Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel Background="White" Margin="10">
                        <Label Content="Patient Name:"/>
                        <TextBox x:Name="TxtPatientName" Margin="0,0,0,5"/>
                        <Label Content="Date of Birth:"/>
                        <DatePicker x:Name="DatePatientBirth" Margin="0,0,0,5"/>
                        <Label Content="Gender:"/>
                        <ComboBox x:Name="CmbPatientGender" Margin="0,0,0,5" SelectedIndex="0">
                            <ComboBoxItem>Male</ComboBoxItem>
                            <ComboBoxItem>Female</ComboBoxItem>
                        </ComboBox>
                        <Label Content="Contact Number:"/>
                        <TextBox x:Name="TxtPatientContact" Margin="0,0,0,5"/>
                        <Label Content="Address:"/>
                        <TextBox x:Name="TxtPatientAddress" Height="60" TextWrapping="Wrap" Margin="0,0,0,15"/>
                        <Label Content="Blood Group:"/>
                        <TextBox x:Name="TxtBloodGroup" Height="60" TextWrapping="Wrap" Margin="0,0,0,15"/>
                        <Label Content="Allergies:"/>
                        <TextBox x:Name="TxtAllergies" Height="60" TextWrapping="Wrap" Margin="0,0,0,15"/>
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0" HorizontalAlignment="Left">
                            <Button x:Name="RegisterPatientButton" Content="Register Patient" Width="150" Height="35"
                                    FontWeight="Bold" Background="#28a745" Foreground="White"
                                    Click="RegisterPatientButton_Click" Margin="0,0,10,0"/>
                            <Button x:Name="CancelRegisterButton" Content="Cancel" Width="100" Height="35"
                                    FontWeight="Bold" Background="#dc3545" Foreground="White"
                                    Click="CancelRegisterButton_Click"/>
                        </StackPanel>
                        <TextBlock x:Name="RegisterStatusText" Margin="0,10,0,0" Foreground="Gray" FontStyle="Italic"/>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- OVERLAY RIGHT PANEL -->
        <Border x:Name="RightPanelBorder"
                Canvas.ZIndex="100"
                Width="400"
                Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Window}}"
                Canvas.Left="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}}"
                Canvas.Top="40"
                Background="White"
                BorderBrush="#e0e0e0"
                BorderThickness="1,0,0,0"
                Visibility="Collapsed">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0" Background="#f0f0f0" Padding="10" BorderBrush="#e0e0e0" BorderThickness="0,0,0,1">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch">
                        <Button x:Name="CloseRightPanelButton"
                                Content="×" FontSize="16" FontWeight="Bold"
                                Width="30" Height="30" HorizontalAlignment="Left"
                                Margin="0,0,10,0"
                                Click="CloseRightPanelButton_Click"
                                Background="Transparent" BorderThickness="0"/>
                        <TextBlock Text="Previous Visits History" FontWeight="Bold" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock x:Name="HistoryTextBlock"
                                   TextWrapping="Wrap"
                                   Padding="10"
                                   FontSize="14"
                                   Text="[Patient Visit History will appear here]"/>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>
    </Canvas>
</Window>